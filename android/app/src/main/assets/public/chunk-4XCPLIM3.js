import{a as j}from"./chunk-IG5WGN65.js";import{a as V,f as q,g as N,s as $}from"./chunk-TIRIOUTJ.js";import{a as F}from"./chunk-CAWAZEOC.js";import{i as T,k as G,t as z,u as k,x as D}from"./chunk-AYIUP6ED.js";import{$ as s,A as y,E as g,H as d,I as a,J as r,K as f,Q as M,R as O,S as p,aa as h,ba as m,ga as _,ha as x,ka as S,la as w,na as I,o as b,oa as E,p as C,v as P,w as c,y as v}from"./chunk-5MEF2J7Q.js";import"./chunk-W7HPUEKP.js";import"./chunk-5UWQKTRJ.js";import"./chunk-254F5RPF.js";import"./chunk-PZU7R7Y5.js";import"./chunk-YN4SZ4GL.js";import"./chunk-UQSJFG5S.js";import"./chunk-O6FA337S.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-REYR55MP.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{f as u}from"./chunk-D7YYRZS5.js";function A(o,l){o&1&&(a(0,"div",6)(1,"p"),s(2,"Cargando tus chollos guardados..."),r()())}function W(o,l){o&1&&(a(0,"div",7),f(1,"ion-icon",8),a(2,"h2"),s(3,"No tienes chollos guardados"),r(),a(4,"p"),s(5,"Guarda tus chollos favoritos para verlos aqu\xED"),r()())}function U(o,l){if(o&1&&(a(0,"div",23),s(1),r()),o&2){let e=p().$implicit,n=p(2);c(),m(" ",n.calcDescuento(e),"% ")}}function B(o,l){if(o&1&&(a(0,"span",24),s(1),_(2,"number"),r()),o&2){let e=p().$implicit;c(),m("",x(2,1,e==null?null:e.precio_original,"1.2-2"),"\u20AC")}}function L(o,l){if(o&1){let e=M();a(0,"div",11)(1,"div",12),O("click",function(){let i=b(e).$implicit,t=p(2);return C(t.quitarDeGuardados(i))}),f(2,"ion-icon",13),r(),g(3,U,2,1,"div",14),f(4,"img",15),a(5,"div",16)(6,"div",17)(7,"span"),s(8),r()(),a(9,"div",18),s(10),r(),a(11,"div",19)(12,"span",20),s(13),_(14,"number"),r(),g(15,B,3,4,"span",21),r(),a(16,"button",22),s(17,"A\xF1adir al carrito"),r()()()}if(o&2){let e=l.$implicit,n=p(2);c(3),d("ngIf",n.calcDescuento(e)>0),c(),d("src",(e==null?null:e.imagen_url)||"https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1200&auto=format&fit=crop",P),c(4),h(e==null?null:e.proveedor),c(2),h(e==null?null:e.titulo),c(3),m("",x(14,6,e==null?null:e.precio_actual,"1.2-2"),"\u20AC"),c(2),d("ngIf",e==null?null:e.precio_original)}}function H(o,l){if(o&1&&(a(0,"div",9),g(1,L,18,9,"div",10),r()),o&2){let e=p();c(),d("ngForOf",e.chollosGuardados)}}var et=(()=>{let l=class l{constructor(n,i){this.supabaseService=n,this.favoritosEventService=i,this.chollosGuardados=[],this.cargando=!0,V({heart:q,heartOutline:N,trashOutline:$})}ionViewWillEnter(){return u(this,null,function*(){console.log("Tab3 ionViewWillEnter"),yield this.cargarGuardados(),(!this.favoritosSubscription||this.favoritosSubscription.closed)&&(console.log("Tab3 suscribi\xE9ndose a eventos"),this.favoritosSubscription=this.favoritosEventService.favoritosChanged$.subscribe(()=>{console.log("Tab3 recibi\xF3 evento favoritosChanged"),this.cargarGuardados()}))})}ionViewWillLeave(){console.log("Tab3 ionViewWillLeave"),this.favoritosSubscription&&this.favoritosSubscription.unsubscribe()}cargarGuardados(){return u(this,null,function*(){console.log("Tab3 cargando guardados...");try{this.cargando=!0;let n=yield this.supabaseService.getChollosGuardados();console.log("Datos recibidos de Supabase:",n);let i=new Map;n.forEach(t=>{t.chollos&&!i.has(t.chollos.id)&&i.set(t.chollos.id,{id:t.chollos.id,titulo:t.chollos.titulo,precio_actual:t.chollos.precio_actual,precio_original:t.chollos.precio_original,imagen_url:t.chollos.imagen_url,proveedor:t.chollos.proveedores?.nombre||"Sin proveedor",guardado_id:t.id})}),this.chollosGuardados=Array.from(i.values()),console.log("Chollos \xFAnicos procesados:",this.chollosGuardados)}catch(n){console.error("Error al cargar guardados:",n)}finally{this.cargando=!1}})}quitarDeGuardados(n){return u(this,null,function*(){try{yield this.supabaseService.eliminarCholloFavorito(n.id),this.favoritosEventService.notificarCambio(),yield this.cargarGuardados()}catch(i){console.error("Error al quitar de guardados:",i)}})}calcDescuento(n){let i=Number(n?.precio_actual||0),t=Number(n?.precio_original||0);return!i||!t||t<=i?0:Math.round((t-i)/t*100)}};l.\u0275fac=function(i){return new(i||l)(v(F),v(j))},l.\u0275cmp=y({type:l,selectors:[["app-tab3"]],decls:9,vars:5,consts:[[1,"header-red",3,"translucent"],[3,"fullscreen"],[1,"guardados-container"],["class","loading",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","guardados-list",4,"ngIf"],[1,"loading"],[1,"empty-state"],["name","heart-outline",1,"empty-icon"],[1,"guardados-list"],["class","chollo-card",4,"ngFor","ngForOf"],[1,"chollo-card"],[1,"fav-icon",3,"click"],["name","heart"],["class","badge",4,"ngIf"],[1,"cover",3,"src"],[1,"meta"],[1,"provider"],[1,"title"],[1,"prices"],[1,"now"],["class","old",4,"ngIf"],[1,"btn-cart"],[1,"badge"],[1,"old"]],template:function(i,t){i&1&&(a(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),s(3,"Guardados"),r()()(),a(4,"ion-content",1)(5,"div",2),g(6,A,3,0,"div",3)(7,W,6,0,"div",4)(8,H,2,1,"div",5),r()()),i&2&&(d("translucent",!0),c(4),d("fullscreen",!0),c(2),d("ngIf",t.cargando),c(),d("ngIf",!t.cargando&&t.chollosGuardados.length===0),c(),d("ngIf",!t.cargando&&t.chollosGuardados.length>0))},dependencies:[E,S,w,G,k,z,T,D,I],styles:['@charset "UTF-8";.header-red[_ngcontent-%COMP%]{--background: var(--ion-color-primary);color:#fff}ion-content[_ngcontent-%COMP%]{--background: #f4f5f8}.guardados-container[_ngcontent-%COMP%]{padding:14px}.loading[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:80px;color:#ccc;margin-bottom:20px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:900;margin-bottom:10px;color:#333}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:14px}.guardados-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}.chollo-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;box-shadow:0 12px 30px #0000001a;overflow:hidden;position:relative}.badge[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;background:var(--ion-color-primary);color:#fff;font-weight:900;font-size:12px;padding:4px 10px;border-radius:999px;z-index:2}.cover[_ngcontent-%COMP%]{width:100%;height:170px;object-fit:cover;background:#f2f2f2}.meta[_ngcontent-%COMP%]{padding:12px}.provider[_ngcontent-%COMP%]{margin-bottom:8px}.provider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;opacity:.7;font-weight:600}.title[_ngcontent-%COMP%]{font-size:14px;font-weight:900;line-height:1.15;margin-bottom:8px}.prices[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:baseline;margin-bottom:12px}.prices[_ngcontent-%COMP%]   .now[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:900;font-size:18px}.prices[_ngcontent-%COMP%]   .old[_ngcontent-%COMP%]{color:#999;text-decoration:line-through;font-size:13px}ion-button[_ngcontent-%COMP%]{--border-radius: 12px;font-weight:900}.fav-icon[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;z-index:3;cursor:pointer;background:#ffffffe6;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.fav-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:var(--ion-color-primary)}.fav-icon[_ngcontent-%COMP%]:hover{transform:scale(1.1);background:#fff}.fav-icon[_ngcontent-%COMP%]:active{transform:scale(.95)}.btn-cart[_ngcontent-%COMP%]{width:100%;border:0;margin-top:5px;padding:12px;border-radius:14px;background:#4a90e2;color:#fff;font-weight:900;font-size:14px;cursor:pointer;transition:opacity .2s}.btn-cart[_ngcontent-%COMP%]:active{opacity:.8}']});let o=l;return o})();export{et as Tab3Page};
