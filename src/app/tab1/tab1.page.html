
<ion-header class="header-red" translucent="true">
  <ion-toolbar>
    <div class="topbar">
      <div class="brand">CHOLLONES</div>

      <div class="search-wrap">
        <ion-searchbar placeholder="Buscar cualquier cosa" (ionInput)="onSearch($event)"
          class="searchbar"></ion-searchbar>
      </div>

      <ion-buttons slot="end">
        <ion-button fill="clear" (click)="irAGuardados()">
          <ion-icon name="heart-outline"></ion-icon>
        </ion-button>

        <ion-button fill="clear">
          <ion-icon name="person-outline"></ion-icon>
        </ion-button>

        <ion-button fill="clear" class="cart-btn">
          <ion-icon name="bag-outline"></ion-icon>
          <span class="cart-badge">{{ cartCount }}</span>
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Banner grande -->
  <div class="banner" [style.background-image]="'url(' + bannerUrl + ')'">
    <div class="banner-overlay">
      <div class="banner-kicker">CHOLLONES</div>
      <div class="banner-title">Los mejores chollos cerca de ti</div>
      <div class="banner-sub">Ahorra en productos y servicios en un solo clic</div>
      <button class="banner-btn">Ver ofertas</button>
    </div>
  </div>

  <!-- Últimas ofertas -->
  <div class="section">
    <div class="section-title">
      <h3>Últimas ofertas</h3>
      <a class="link">Ver todas</a>
    </div>

    <div class="quick-grid">
      <div class="quick-item" *ngFor="let q of quickLinks">
        <img [src]="q.img" />
        <div class="quick-text">{{ q.title }}</div>
        <div class="quick-cta">Comprar ahora</div>
      </div>
    </div>
  </div>

  <!-- Productos populares -->
  <div class="section">
    <div class="section-title">
      <h3>Productos populares</h3>
      <a class="link">Ver todos</a>
    </div>

    <div class="popular-row">
      <div class="product-card" *ngFor="let p of productosPopulares">
        <div class="pill" *ngIf="p.nuevo">Nuevo</div>
        <div class="disc" *ngIf="p.descuento">{{ p.descuento }}%</div>

        <img class="product-img" [src]="p.imagen" />

        <div class="product-body">
          <div class="product-cat">{{ p.categoria }}</div>
          <div class="product-title">{{ p.titulo }}</div>
          <div class="product-prov">{{ p.proveedor }}</div>

          <div class="product-prices">
            <span class="p-now">{{ p.precioActual }}€</span>
            <span class="p-old" *ngIf="p.precioOriginal">{{ p.precioOriginal }}€</span>
          </div>

          <button class="btn-buy">+ {{ p.precioActual }} €</button>
          <button class="btn-cart">Añadir al carrito</button>

          <div class="fav" (click)="toggleFavorito(p, $event)">
            <ion-icon [name]="isFavorito(p.id) ? 'heart' : 'heart-outline'"></ion-icon>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Nuestros chollos más recientes (Supabase) -->
  <div class="section">
    <div class="section-title">
      <h3>Nuestros chollos</h3>
      <a class="link">Ver todos</a>
    </div>

    <div class="cards-row">
      <div class="chollo-card" *ngFor="let c of chollosFiltrados">
        <div class="badge" [class.badge-hot]="c?.punto?.estado === 'Caliente'">
          {{ calcDescuento(c) }}%
        </div>

        <div class="fav-icon" (click)="toggleFavorito(c, $event)">
          <ion-icon [name]="isFavorito(c.id) ? 'heart' : 'heart-outline'"></ion-icon>
        </div>

        <img class="cover"
          [src]="c?.imagen || 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1200&auto=format&fit=crop'" />

        <div class="meta">
          <div class="provider">
            <img class="logo" [src]="c?.proveedor?.logo" />
            <span>{{ c?.proveedor?.nombre }}</span>
          </div>

          <div class="title">{{ c?.titulo }}</div>

          <div class="prices">
            <span class="now">{{ c?.precio_actual | number:'1.2-2' }}€</span>
            <span class="old">{{ c?.precio_original | number:'1.2-2' }}€</span>
          </div>

          <button class="btn-add">+ {{ c?.precio_actual | number:'1.0-0' }} €</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Categorías -->
  <div class="section">
    <div class="section-title">
      <h3>Categorías más populares</h3>
      <a class="link">Ver todas</a>
    </div>

    <div class="cat-strip">
      <div class="cat-item" *ngFor="let cat of categorias">
        <img [src]="cat.img" />
        <div>{{ cat.nombre }}</div>
      </div>
    </div>
  </div>
</ion-content>
