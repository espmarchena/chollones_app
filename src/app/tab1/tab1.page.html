<ion-content fullscreen>
  <!-- Banner grande -->
  <div class="banner" [style.background-image]="'url(' + bannerUrl + ')'">
    <div class="banner-overlay">
      <div class="banner-kicker">CHOLLONES</div>
      <div class="banner-title">Los mejores chollos cerca de ti</div>
      <div class="banner-sub">Ahorra en productos y servicios en un solo clic</div>
      <button class="banner-btn" (click)="router.navigate(['/tabs/tab4'])">Ver ofertas</button>
    </div>
  </div>

  <!-- Enlaces Rápidos Circulares -->
  <div class="section">
    <div class="section-title">
      <h3>Nuestros Chollos</h3>
    </div>
    <div class="quick-row">
      <div class="quick-circle-item" *ngFor="let q of quickLinks"
        (click)="router.navigate(['/tabs/tab4'], { queryParams: { filtro: q.id } })">
        <div class="circle-bg" [style.background-color]="q.bgColor">
          <img [src]="q.img" />
        </div>
        <div class="quick-text">{{ q.title }}</div>
        <div class="quick-cta">Comprar ahora</div>
      </div>
    </div>
  </div>

  <!-- Productos populares -->
  <div class="section">
    <div class="section-title">
      <h3>Productos populares</h3>
      <a class="link">Ver todos</a>
    </div>

    <div class="popular-row">
      <div class="product-card" *ngFor="let p of productosPopulares">
        <div class="disc" *ngIf="p.descuento">-{{ p.descuento }}%</div>

        <div class="fav-icon" (click)="toggleFavorito(p, $event)" [class.active]="isFavorito(p.id)">
          <ion-icon name="heart"></ion-icon>
        </div>

        <img class="product-img" [src]="p.imagen" />

        <div class="product-body">
          <div class="product-cat">{{ p.categoria }}</div>
          <div class="product-title">{{ p.titulo }}</div>
          <div class="product-prov">{{ p.proveedor }}</div>

          <div class="product-prices">
            <span class="p-now">{{ p.precioActual | number:'1.2-2' }}€</span>
            <span class="p-old" *ngIf="p.precioOriginal">{{ p.precioOriginal | number:'1.2-2' }}€</span>
          </div>

          <button class="btn-cart">Añadir al carrito</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Nuestros chollos más recientes (Supabase) -->
  <div class="section">
    <div class="section-title">
      <h3>Nuestros chollos</h3>
      <a class="link">Ver todos</a>
    </div>

    <div class="cards-row">
      <div class="product-card" *ngFor="let c of chollosFiltrados">
        <div class="disc" [class.badge-hot]="c?.punto?.estado === 'Caliente'">
          -{{ calcDescuento(c) }}%
        </div>

        <div class="fav-icon" (click)="toggleFavorito(c, $event)" [class.active]="isFavorito(c.id)">
          <ion-icon name="heart"></ion-icon>
        </div>

        <img class="product-img"
          [src]="c?.imagen || 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1200&auto=format&fit=crop'" />

        <div class="product-body">
          <div class="product-prov" *ngIf="c?.proveedor">
            <img class="logo" [src]="c?.proveedor?.logo"
              style="width:20px;height:20px;border-radius:50%;object-fit:cover;" *ngIf="c?.proveedor?.logo" />
            <span>{{ c?.proveedor?.nombre }}</span>
          </div>

          <div class="product-title">{{ c?.titulo }}</div>

          <div class="product-prices">
            <span class="p-now">{{ c?.precio_actual | number:'1.2-2' }}€</span>
            <span class="p-old" *ngIf="c?.precio_original">{{ c?.precio_original | number:'1.2-2' }}€</span>
          </div>

          <button class="btn-cart">Añadir al carrito</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Categorías -->
  <div class="section">
    <div class="section-title">
      <h3>Categorías más populares</h3>
      <a class="link">Ver todas</a>
    </div>

    <div class="cat-strip">
      <div class="cat-item" *ngFor="let cat of categorias" (click)="irACategoria(cat.slug)">
        <img [src]="cat.img" />
        <div>{{ cat.nombre }}</div>
      </div>
    </div>
  </div>
</ion-content>